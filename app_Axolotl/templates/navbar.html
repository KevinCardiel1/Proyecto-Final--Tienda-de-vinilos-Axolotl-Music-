{% load static %}
{% load cart_tags %}

{% if request.user.is_authenticated and request.user.is_staff %}
    <!-- ADMIN NAVBAR: same visual style as client but with admin actions -->
    <nav style="background: linear-gradient(90deg, #ffdff3 0%, #ff66cc 100%); padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; gap: 20px; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.15); flex-wrap: wrap;">
        <div style="flex-shrink: 0; display: flex; align-items: center; gap: 10px;">
            <a href="{% url 'index_frontend' %}" style="display: flex; align-items: center; gap: 8px; text-decoration: none; color: white;">
                <img src="{% static 'vinyl.svg' %}" alt="Logo AXOLOTL MUSIC" loading="lazy" class="responsive-img" style="width: 36px; height: 36px;">
                <h1 style="margin: 0; font-size: 14px; line-height: 16px; color: white; font-weight: 900; letter-spacing: 0.5px; text-transform: uppercase;">AXOLOTL MUSIC</h1>
            </a>
        </div>

        <ul style="display: flex; gap: 18px; margin: 0; padding: 0; list-style: none; flex: 1; justify-content: center; flex-wrap: wrap; align-items: center;">
            <li style="display:flex; align-items:center; gap:6px;">
                <strong style="color: white; font-size: 16px;">ARTISTAS</strong>
                <a href="{% url 'ver_artistas' %}" style="color: white; text-decoration: underline; font-size: 13px;">Ver</a>
                <a href="{% url 'agregar_artistas' %}" style="color: white; text-decoration: underline; font-size: 13px;">Agregar</a>
            </li>
            <li style="display:flex; align-items:center; gap:6px;">
                <strong style="color: white; font-size: 16px;">CLIENTES</strong>
                <a href="{% url 'ver_clientes' %}" style="color: white; text-decoration: underline; font-size: 13px;">Ver</a>
                <a href="{% url 'agregar_cliente' %}" style="color: white; text-decoration: underline; font-size: 13px;">Agregar Cliente</a>
            </li>
            <li style="display:flex; align-items:center; gap:6px;">
                <strong style="color: white; font-size: 16px;">EMPLEADOS</strong>
                <a href="{% url 'ver_empleados' %}" style="color: white; text-decoration: underline; font-size: 13px;">Ver</a>
                <a href="{% url 'agregar_empleado' %}" style="color: white; text-decoration: underline; font-size: 13px;">Agregar Empleado</a>
            </li>
            <li style="display:flex; align-items:center; gap:6px;">
                <strong style="color: white; font-size: 16px;">PRODUCTOS</strong>
                <a href="{% url 'ver_productos' %}" style="color: white; text-decoration: underline; font-size: 13px;">Ver</a>
                <a href="{% url 'agregar_productos' %}" style="color: white; text-decoration: underline; font-size: 13px;">Agregar</a>
            </li>
            <li style="display:flex; align-items:center; gap:6px;">
                <strong style="color: white; font-size: 16px;">DETALLES</strong>
                <a href="{% url 'ver_detalles_pedidos' %}" style="color: white; text-decoration: underline; font-size: 13px;">Ver</a>
                <a href="{% url 'agregar_detalle_pedido' %}" style="color: white; text-decoration: underline; font-size: 13px;">Agregar</a>
            </li>
            <li style="display:flex; align-items:center; gap:6px;">
                <strong style="color: white; font-size: 16px;">PEDIDOS</strong>
                <a href="{% url 'ver_pedidos' %}" style="color: white; text-decoration: underline; font-size: 13px;">Ver</a>
                <a href="{% url 'agregar_pedido' %}" style="color: white; text-decoration: underline; font-size: 13px;">Agregar</a>
            </li>
        </ul>

        <div style="display: flex; align-items: center; gap: 12px; flex-shrink: 0;">
            <a href="{% url 'index_frontend' %}" style="background: rgba(255,255,255,0.12); color: white; padding: 8px 12px; border-radius: 6px; text-decoration: none; font-weight: 700;">Ver pÃ¡gina</a>
            <a href="{% url 'inicio_axolotlmusic' %}" style="background: rgba(0,0,0,0.08); color: white; padding: 8px 12px; border-radius: 6px; text-decoration: none; font-weight: 700;">Panel Admin</a>
            <span style="color: white; font-weight: 600; font-size: 13px;">{{ request.user.username }}</span>
            <button onclick="confirmarLogout()" style="background: #ff4444; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: 700; font-size: 12px;">Cerrar SesiÃ³n</button>
        </div>
    </nav>
{% else %}
    <!-- CLIENT NAVBAR -->
    <nav style="background: linear-gradient(90deg, #ffdff3 0%, #ff66cc 100%); padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; gap: 20px; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.15); flex-wrap: wrap;">
        <div style="flex-shrink: 0; display: flex; align-items: center; gap: 8px;">
            <a href="{% url 'index_frontend' %}" style="display: flex; align-items: center; gap: 6px; text-decoration: none;">
                <img src="{% static 'vinyl.svg' %}" alt="Logo AXOLOTL MUSIC" loading="lazy" class="responsive-img" style="width: 36px; height: 36px;">
                <h1 style="margin: 0; font-size: 12px; line-height: 13px; color: white; font-weight: 900; letter-spacing: 0.5px; text-transform: uppercase;">AXOLOTL<br>MUSIC</h1>
            </a>
        </div>

        <ul style="display: flex; gap: 25px; margin: 0; padding: 0; list-style: none; flex: 1; justify-content: center; flex-wrap: wrap; align-items: center;">
            <li style="position: relative;">
                <a href="{% url 'artistas_frontend' %}" style="text-decoration: none; color: white; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; transition: 0.2s;">ARTISTAS</a>
            </li>
            <li style="position: relative;" class="dropdown-item">
                <a href="javascript:void(0)" onclick="toggleGeneros(event)" style="text-decoration: none; color: white; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer; transition: 0.2s;">GÃ‰NEROS â–¾</a>
                <ul id="generosMenu" style="display: none; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: white; border-radius: 6px; padding: 8px 0; min-width: 140px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 100; list-style: none; margin: 8px 0 0 0;">
                    <li><a href="{% url 'genero_frontend' %}?genero=Pop" style="display: block; padding: 10px 16px; color: #2b0030; text-decoration: none; font-size: 12px; font-weight: 600; transition: 0.2s;">Pop</a></li>
                    <li><a href="{% url 'genero_frontend' %}?genero=K-Pop" style="display: block; padding: 10px 16px; color: #2b0030; text-decoration: none; font-size: 12px; font-weight: 600; transition: 0.2s;">K-Pop</a></li>
                    <li><a href="{% url 'genero_frontend' %}?genero=Rock" style="display: block; padding: 10px 16px; color: #2b0030; text-decoration: none; font-size: 12px; font-weight: 600; transition: 0.2s;">Rock</a></li>
                    <li><a href="{% url 'genero_frontend' %}?genero=Latino" style="display: block; padding: 10px 16px; color: #2b0030; text-decoration: none; font-size: 12px; font-weight: 600; transition: 0.2s;">Latino</a></li>
                </ul>
            </li>
            <li>
                <a href="{% url 'novedades_frontend' %}" style="text-decoration: none; color: white; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; transition: 0.2s;">NOVEDADES</a>
            </li>
            <li style="position: relative;" class="dropdown-item">
                <a href="javascript:void(0)" onclick="toggleMusica(event)" style="text-decoration: none; color: white; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer; transition: 0.2s;">MÃšSICA â–¾</a>
                <ul id="musicaMenu" style="display: none; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: white; border-radius: 6px; padding: 8px 0; min-width: 140px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 100; list-style: none; margin: 8px 0 0 0;">
                    <li><a href="{% url 'tipo_frontend' %}?tipo=Vinilo" style="display: block; padding: 10px 16px; color: #2b0030; text-decoration: none; font-size: 12px; font-weight: 600; transition: 0.2s;">ðŸŽµ Vinilos</a></li>
                    <li><a href="{% url 'tipo_frontend' %}?tipo=CD" style="display: block; padding: 10px 16px; color: #2b0030; text-decoration: none; font-size: 12px; font-weight: 600; transition: 0.2s;">ðŸ’¿ CDs</a></li>
                    <li><a href="{% url 'tipo_frontend' %}?tipo=Casete" style="display: block; padding: 10px 16px; color: #2b0030; text-decoration: none; font-size: 12px; font-weight: 600; transition: 0.2s;">ðŸ“¼ Casetes</a></li>
                </ul>
            </li>
        </ul>

        <div style="display: flex; align-items: center; gap: 12px; flex-shrink: 0;">
            {% if request.user.is_authenticated %}
                {% get_cart_count request.user as cart_count %}
                <a href="{% url 'ver_carrito' %}" style="text-decoration:none; color: white; font-weight:700; background: rgba(255,255,255,0.08); padding:6px 10px; border-radius:6px;">Carrito ({{ cart_count }})</a>
                <a href="{% url 'perfil_usuario' %}" style="color: white; font-weight: 700; font-size: 12px; text-decoration:none;">{{ request.user.username }}</a>
                <button onclick="confirmarLogout()" style="background: rgba(255,255,255,0.3); color: white; border: 1px solid white; padding: 6px 14px; border-radius: 4px; cursor: pointer; font-weight: 700; font-size: 11px; text-transform: uppercase; transition: 0.2s;">Cerrar SesiÃ³n</button>
            {% else %}
                <a href="{% url 'login_frontend' %}" style="background: rgba(255,255,255,0.3); color: white; padding: 6px 14px; border-radius: 4px; text-decoration: none; font-weight: 700; font-size: 11px; text-transform: uppercase; transition: 0.2s; border: 1px solid white;">Iniciar sesiÃ³n</a>
                <a href="{% url 'register' %}" style="background: rgba(0,0,0,0.2); color: white; padding: 6px 14px; border-radius: 4px; text-decoration: none; font-weight: 700; font-size: 11px; text-transform: uppercase; transition: 0.2s; border: none;">Registrarse</a>
            {% endif %}
        </div>
    </nav>

{% endif %}

<!-- MODAL DE CONFIRMACIÃ“N LOGOUT -->
<div id="logoutModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 10000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 30px; border-radius: 12px; max-width: 400px; text-align: center; box-shadow: 0 5px 25px rgba(0,0,0,0.3);">
        <h2 style="color: #ff66cc; margin-bottom: 15px;">Â¿Cerrar SesiÃ³n?</h2>
        <p style="color: #666; margin-bottom: 25px;">Â¿EstÃ¡s seguro de que deseas cerrar sesiÃ³n?</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button onclick="cancelarLogout()" style="padding: 10px 20px; background: #ccc; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.3s;">Cancelar</button>
            <a href="{% url 'logout' %}" style="padding: 10px 20px; background: #ff4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; text-decoration: none; display: inline-block; transition: 0.3s;">SÃ­, Cerrar SesiÃ³n</a>
        </div>
    </div>
</div>

<script>
    function confirmarLogout() {
        document.getElementById('logoutModal').style.display = 'flex';
    }
    function cancelarLogout() {
        document.getElementById('logoutModal').style.display = 'none';
    }
    
    function toggleGeneros(e) {
        e.preventDefault();
        const menu = document.getElementById('generosMenu');
        const musicaMenu = document.getElementById('musicaMenu');
        musicaMenu.style.display = 'none';
        menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    }
    
    function toggleMusica(e) {
        e.preventDefault();
        const menu = document.getElementById('musicaMenu');
        const generosMenu = document.getElementById('generosMenu');
        generosMenu.style.display = 'none';
        menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    }
    
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.dropdown-item')) {
            const gm = document.getElementById('generosMenu');
            const mm = document.getElementById('musicaMenu');
            if (gm) gm.style.display = 'none';
            if (mm) mm.style.display = 'none';
        }
    });
</script>
<!-- MODAL: Solicitar inicio de sesiÃ³n antes de proceder -->
<div id="loginPromptModal" style="display:none; position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.6); z-index:10001; align-items:center; justify-content:center;">
    <div style="background: white; padding: 22px; border-radius: 12px; max-width: 420px; width: 90%; text-align: center; box-shadow: 0 6px 30px rgba(0,0,0,0.35);">
        <h3 style="color:#2b0030; margin-top:0;">Necesitas iniciar sesiÃ³n</h3>
        <p style="color:#666; margin: 8px 0 18px;">Para completar esta acciÃ³n debes iniciar sesiÃ³n. Â¿Quieres ir a la pÃ¡gina de inicio de sesiÃ³n?</p>
        <div style="display:flex; gap:10px; justify-content:center;">
            <button id="loginModalCancel" style="padding:10px 16px; background:#eee; border:none; border-radius:8px; cursor:pointer; font-weight:700;">Cancelar</button>
            <a id="loginModalGo" href="#" style="padding:10px 16px; background: linear-gradient(90deg,#ff66cc,#c51a8d); color:white; text-decoration:none; border-radius:8px; font-weight:700;">Ir a Iniciar sesiÃ³n</a>
        </div>
    </div>
</div>

<script>
    (function(){
        let lastRequireElement = null;
        function openLoginModal(el){
            lastRequireElement = el;
            const modal = document.getElementById('loginPromptModal');
            const go = document.getElementById('loginModalGo');
            // compute login url from data attribute or fallback to login page
            const base = (el && el.getAttribute('data-login-url')) || "{% url 'login_frontend' %}";
            const next = encodeURIComponent(window.location.pathname + window.location.search);
            go.setAttribute('href', base + '?next=' + next);
            modal.style.display = 'flex';
        }
        function closeLoginModal(){
            const modal = document.getElementById('loginPromptModal');
            modal.style.display = 'none';
            lastRequireElement = null;
        }

        document.addEventListener('click', function(e){
            const btn = e.target.closest('.require-login');
            if(btn){
                e.preventDefault();
                openLoginModal(btn);
                return;
            }
        });

        document.getElementById('loginModalCancel').addEventListener('click', function(){ closeLoginModal(); });
        // also close when clicking outside the dialog content
        document.getElementById('loginPromptModal').addEventListener('click', function(e){
            if(e.target === this) closeLoginModal();
        });
    })();
</script>
<script>
    // Detect low-spec devices and reduce animations/effects for better performance
    (function(){
        try {
            var hw = navigator.hardwareConcurrency || 4;
            var mem = navigator.deviceMemory || 4;
            var save = (navigator.connection && navigator.connection.saveData) || false;
            if (hw <= 2 || (mem && mem <= 1) || save) {
                document.documentElement.classList.add('low-spec');
            }
        } catch(e) {
            // ignore detection errors
        }
    })();
</script>